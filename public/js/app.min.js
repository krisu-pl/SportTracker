"use strict";$(document).ready(function(){function t(t){return("0"+t).slice(-2)}var a,e={};a=L.map("map");var n=new L.tileLayer("https://api.mapbox.com/styles/v1/krisu/ciqpgxyy0003wcankixy95bud/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia3Jpc3UiLCJhIjoiY2lxcGd5enllMDA2MGh5bWFrYnA0Z2hwMiJ9.4j9N70VORhhTh1eUOSjL3A",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',maxZoom:18}).addTo(a),i=L.control.elevation({theme:"steelblue-theme",width:600,height:100,margins:{top:0,right:0,bottom:0,left:0}});i.addTo(a);var o="trasa.gpx",d=new L.GPX(o,{async:!0,marker_options:{startIconUrl:"../images/pin-icon-start.png",endIconUrl:"../images/pin-icon-end.png",shadowUrl:"../images/pin-shadow.png"}});d.on("loaded",function(t){a.fitBounds(t.target.getBounds())}),d.on("addline",function(t){i.addData(t.line)}),d.addTo(a),a.addLayer(n);var l=$("#event-data-table").DataTable({dom:'<<"general-table-top"lf><t><"general-table-bottom"ip>>'}),r=$("#following-data-table"),c=io();c.on("connect",function(){console.log(this.id),c.emit("follow-event",$("#event-id").data("event-id"))}),c.on("refresh",function(t){console.log("CHECKPOINT REFRESH");var a=$("#event-data-table").find("td[data-checkpoint-id='"+t.checkpoint_id+"'][data-participant-id='"+t.participant_id+"']").eq(0),e=$("#following-data-table").find("td[data-checkpoint-id='"+t.checkpoint_id+"'][data-participant-id='"+t.participant_id+"']").eq(0);if(a.length>0){var n=l.cell(a);n.data(t.time),a.addClass("updated"),n.draw(),setTimeout(function(){a.removeClass("updated")},3e3)}e.length>0&&(e.text(t.time),e.addClass("updated"),setTimeout(function(){e.removeClass("updated")},3e3))}),c.on("location-update",function(t){console.log("location-update"),console.log(t);var n=e[t.participant_event_id];n&&(n.getLatLng().equals(L.latLng(0,0))&&n.addTo(a),n.setLatLng(L.latLng(t.lat,t.lng)))}),$("#event-data-table").on("click","span.follow",function(){var t=$(this).parents("tr").data("participant-event-id");$(this).hide(),$(this).siblings(".unfollow").show(),c.emit("follow-participant",t);var a=$(this).parent().siblings(".participant_name").text(),n=L.marker([0,0]).bindLabel(""+a,{noHide:!0,direction:"auto"});e[t]=n;var i=$(this).parents("tr").clone(),o=i.children("td");o.splice(1,3),o.splice(o.length-1,1),r.children("tbody").append('<tr data-participant-event-id="'+t+'">'),r.children("tbody").children("tr:last").append(o)}).on("click","span.unfollow",function(){var t=$(this).parents("tr").data("participant-event-id");$(this).hide(),$(this).siblings(".follow").show(),c.emit("unfollow-participant",t),delete e[t],r.find('tr[data-participant-event-id="'+t+'"]').remove()}),$("#simulate-choose_event").on("change",function(t){var a=this.value;window.location.href+="event?id="+a}),function(){function a(){var a=new Date,o=a-d,l="";if(o<0){l="-";var r=Math.ceil(o/i)*-1,c=Math.ceil(o%i/n)*-1,s=Math.ceil(o%n/e)*-1}else var r=Math.floor(o/i),c=Math.floor(o%i/n),s=Math.floor(o%n/e);$("#event-time").html(l+t(r)+":"+t(c)+":"+t(s))}var e=1e3,n=60*e,i=60*n,o=$("#event-time").data("startdate"),d=new Date(o);setInterval(a,1e3)}()});