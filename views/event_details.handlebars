<div class="padding-20">
    <p id="event-id" data-event-id="{{event.id}}">
        <b>{{event.name}}</b>
    </p>

    <p>{{event.start_date}}</p>

    {{#if event.finished}}
        <h1>Finished.</h1>
    {{else}}
        <h1 id="event-time" data-startdate="{{event.start_date}}">&nbsp;</h1>
    {{/if}}

    <div id="map"></div>

    <table id="event-data-table">
        <thead>
            <th>Participant's name</th>
            <th>Number</th>
            <th>Category</th>
            <th>Team</th>
            <th>City</th>
            {{#each checkpoints}}
                <th data-checkpoint-id="{{id}}">{{name}}</th>
            {{/each}}
        </thead>
        <tbody>
            {{#each participants}}
                <tr>
                    <td>{{participant_name}}</td>
                    <td>{{starting_number}}</td>
                    <td>{{category_name}}</td>
                    <td>{{team}}</td>
                    <td>{{city}}</td>
                    {{#each ../checkpoints}}
                        <td data-checkpoint-id="{{id}}" data-participant-id="{{../id}}">
                            {{lookup ../times id}}
                        </td>
                    {{/each}}
                </tr>
            {{/each}}
        </tbody>
    </table>

</div>


<script>

    //    var spinner;
    //
    //    $(document).ready(function(){
    //        var target = $('#spinner');
    //        spinner = new Spinner().spin();
    //        target.append(spinner.el)
    //    });


    var dataSet = [];

    var table = $('#event-data-table').DataTable();


    var socket = io();
    socket.emit('follow-event', $('#event-id').data('event-id'));

    socket.on('refresh', function (data) {
//        spinner.stop();
//        $('#spinner').remove();

        var $cell = $("td[data-checkpoint-id='" + data.checkpoint_id +"'][data-participant-id='" + data.participant_id +"']");

        var tableCell = table.cell($cell);
        tableCell.data(data.time);
        $cell.addClass('updated');
        tableCell.draw();
        setTimeout(function () {
            $cell.removeClass('updated');
        }, 3000);

    });
</script>